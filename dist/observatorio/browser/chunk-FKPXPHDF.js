import{a as pe,b as ue,c as he,d as fe,e as ve,f as _e,g as ge,h as Ee,i as Ae,j as be,k as xe,l as Ce,m as Se,n as D,o as Fe,p as we}from"./chunk-RWFDQMIQ.js";import{a as De,b as ye,c as Me}from"./chunk-AZIIFHVM.js";import{a as ne,b as le,c as de,d as me,e as ce,f as w,g as se}from"./chunk-QOWQCIFR.js";import"./chunk-OZDNAGIT.js";import{a as ee,b as te,e as ie,f as ae,g as oe,h as re}from"./chunk-NO3MC2F2.js";import{b as Z}from"./chunk-2UOJ7Y6R.js";import"./chunk-ABDJEFZA.js";import"./chunk-EJJBCPAK.js";import{a as X,b as Y}from"./chunk-CVC73JUT.js";import"./chunk-75CMSFKH.js";import{a as Q,b as S,d as B,e as $,f as L,g as z,h as F,j as G,k as W,l as P,q as J,r as K}from"./chunk-UQDV26LH.js";import{h as j,j as H}from"./chunk-LS3WY25F.js";import{$b as k,Ab as A,Db as v,Fb as u,Kb as b,Lb as x,Mb as C,Ob as n,Qb as y,Ra as I,Ua as d,Va as _,Wb as R,Xb as V,_b as N,ha as M,jb as p,kb as T,lb as c,pa as h,qa as f,ub as r,vb as a,wb as s,wc as U,xb as g,yb as E,yc as q,zc as O}from"./chunk-BXJQFZYG.js";var Re=["fileInput"],Ve=()=>[5,10,25,100];function Ne(o,m){if(o&1&&(r(0,"div",42)(1,"label",21),n(2,"Foto de portada"),a(),s(3,"br")(4,"img",43),a()),o&2){let e=u();d(4),c("src",e.imagenURL,I)}}function ke(o,m){o&1&&(r(0,"div",57),n(1," Nombre del archivo es obligatorio "),a())}function Ue(o,m){o&1&&(r(0,"div",57),n(1," Fecha de registro es obligatoria "),a())}function qe(o,m){o&1&&(r(0,"div",57),n(1," Descripci\xF3n es obligatoria "),a())}function Oe(o,m){o&1&&(r(0,"div",57),n(1," Debe seleccionar un archivo "),a())}function je(o,m){if(o&1){let e=A();r(0,"div",13)(1,"form",44),v("ngSubmit",function(){h(e);let i=u();return f(i.registrarEntidadAliada())}),r(2,"div",45)(3,"div",46)(4,"label",47),n(5,"Nombre del Archivo"),a(),s(6,"input",48),p(7,ke,2,0,"div",49),a(),r(8,"div",50)(9,"label",51),n(10,"Fecha de Registro"),a(),s(11,"input",52),p(12,Ue,2,0,"div",49),a()(),r(13,"div",20)(14,"label",21),n(15,"Descripci\xF3n"),a(),s(16,"textarea",53),p(17,qe,2,0,"div",49),a(),r(18,"div",20)(19,"label",54),n(20,"Documentos"),a(),r(21,"input",55,1),v("change",function(i){h(e);let l=u();return f(l.onFileSelected(i))}),a(),p(23,Oe,2,0,"div",49),a(),r(24,"button",56),n(25,"Subir Documentos"),a()()()}if(o&2){let e,t,i,l=u();d(),c("formGroup",l.ArchivoEntidadAliadaForm),d(6),c("ngIf",((e=l.ArchivoEntidadAliadaForm.get("nombre_archivo"))==null?null:e.invalid)&&((e=l.ArchivoEntidadAliadaForm.get("nombre_archivo"))==null?null:e.touched)),d(5),c("ngIf",((t=l.ArchivoEntidadAliadaForm.get("fecha_registro"))==null?null:t.invalid)&&((t=l.ArchivoEntidadAliadaForm.get("fecha_registro"))==null?null:t.touched)),d(5),c("ngIf",((i=l.ArchivoEntidadAliadaForm.get("descripcion"))==null?null:i.invalid)&&((i=l.ArchivoEntidadAliadaForm.get("descripcion"))==null?null:i.touched)),d(6),c("ngIf",!l.archivoFile&&l.ArchivoEntidadAliadaForm.touched)}}function He(o,m){o&1&&(r(0,"th",58),n(1," Nombre del archivo "),a())}function Qe(o,m){if(o&1&&(r(0,"td",59),n(1),a()),o&2){let e=m.$implicit;d(),y(" ",e.nombre_archivo," ")}}function Be(o,m){o&1&&(r(0,"th",58),n(1," Fecha de registro "),a())}function $e(o,m){if(o&1&&(r(0,"td",59),n(1),N(2,"date"),a()),o&2){let e=m.$implicit;d(),y(" ",k(2,1,e.fecha_registro,"dd/MM/yyyy")," ")}}function Le(o,m){o&1&&(r(0,"th",60),n(1," Acciones "),a())}function ze(o,m){if(o&1){let e=A();r(0,"td",59)(1,"button",61),v("click",function(){let i=h(e).$implicit,l=u();return f(l.descargarArchivo(i))}),r(2,"mat-icon"),n(3,"cloud_download"),a()(),r(4,"button",62),v("click",function(){let i=h(e).$implicit,l=u();return f(l.eliminarArchivo(i.id_archivo_entidad_aliada))}),r(5,"mat-icon"),n(6,"delete"),a()()()}}function Ge(o,m){o&1&&s(0,"tr",63)}function We(o,m){o&1&&s(0,"tr",64)}function Pe(o,m){if(o&1&&(r(0,"tr",65)(1,"td",66),n(2," No se encontraron archivos para esta entidad aliada. "),a()()),o&2){let e=u();d(),T("colspan",e.displayedColumns.length)}}var wt=(()=>{class o{toggleFormulario(){this.mostrarFormulario=!this.mostrarFormulario}constructor(e,t,i){this.route=e,this.router=t,this.api=i,this.displayedColumns=["nombre_archivo","fecha_registro","acciones"],this.dataSource=new Se([]),this.imagenURL=null,this.entidad_aliada={nombre:"",descripcion:"",fecha_registro:"",portada:""},this.archivoFile=null,this.ArchivoEntidadAliadaForm=new L({nombre_archivo:new F("",S.required),descripcion:new F("",S.required),fecha_registro:new F("",S.required)}),this.archivo_entidad_aliada=[],this.mostrarFormulario=!1}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");this.id_entidad_aliada=e,console.log("ID recibido:",e),this.getDetalleEntidadAliada(e),this.getAllArchivoEntidadAliada(e)}getDetalleEntidadAliada(e){this.api.getDetalleEntidadAliada(e).subscribe({next:t=>{let i=t[0];this.entidad_aliada=i,this.imagenURL=this.getImageUrl(i.portada)},error:t=>{console.error("Error al cargar los detalles:",t)}})}getAllArchivoEntidadAliada(e){this.api.getAllArchivoEntidadAliada(1,e).subscribe({next:t=>{this.archivo_entidad_aliada=t,this.dataSource.data=t,console.log("Archivos cargados:",this.archivo_entidad_aliada)},error:t=>{console.error("Error al cargar los archivos:",t),alert("Error al cargar los archivos. Por favor verifica la consola para m\xE1s informaci\xF3n.")}})}getImageUrl(e){return e?e.startsWith("http://")||e.startsWith("https://")?e:encodeURI(`http://localhost:80/API OBSERVATORIO/${e}`):"assets/img/no-image.jpg"}onFileSelected(e){let t=e.target.files[0];t&&(this.archivoFile=t,console.log("Archivo seleccionado:",this.archivoFile?this.archivoFile.name:"No se seleccion\xF3 archivo"))}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}descargarArchivo(e){let t=this.getFileUrl(e.ruta_archivo),i=document.createElement("a");i.href=t,i.download=e.nombre_archivo,document.body.appendChild(i),i.click(),document.body.removeChild(i)}getFileUrl(e){return e?e.startsWith("http://")||e.startsWith("https://")?e:encodeURI(`http://localhost:80/API OBSERVATORIO/${e}`):""}eliminarArchivo(e){confirm("\xBFEst\xE1s seguro de que deseas eliminar este archivo?")&&this.api.deleteArchivoEntidadAliada(e).subscribe({next:t=>{console.log("archivo eliminado correctamente"),this.getAllArchivoEntidadAliada(this.id_entidad_aliada)},error:t=>{console.error("Error al eliminar la entidad :",t)}})}resetFileInput(){this.fileInput&&this.fileInput.nativeElement?(this.fileInput.nativeElement.value="",console.log("Input file reseteado")):console.log("No se pudo resetear el input file (referencia no disponible)")}registrarEntidadAliada(){if(console.log("M\xE9todo registrarEntidadAliada ejecutado"),this.ArchivoEntidadAliadaForm.valid&&this.archivoFile){console.log("Formulario v\xE1lido y archivo seleccionado");let e=localStorage.getItem("token");if(!e){console.error("No se encontr\xF3 el token");return}let t=new FormData;t.append("nombre_archivo",this.ArchivoEntidadAliadaForm.get("nombre_archivo")?.value||""),t.append("descripcion",this.ArchivoEntidadAliadaForm.get("descripcion")?.value||""),t.append("fecha_registro",this.ArchivoEntidadAliadaForm.get("fecha_registro")?.value||""),t.append("ruta_archivo",this.archivoFile,this.archivoFile.name),t.append("id_entidad_aliada",this.id_entidad_aliada||""),t.append("token",e),console.log("Enviando datos al servidor..."),this.api.postArchivoEntidadAliada(t).subscribe({next:i=>{console.log("Archivo registrado con \xE9xito",i),alert("Archivo subido correctamente"),this.ArchivoEntidadAliadaForm.reset(),this.archivoFile=null,this.resetFileInput(),this.getAllArchivoEntidadAliada(this.id_entidad_aliada)},error:i=>{console.error("Error al registrar el archivo",i),alert("Error al subir el archivo")}})}else console.log("Formulario inv\xE1lido o no se ha seleccionado un archivo"),console.log("Estado del formulario:",this.ArchivoEntidadAliadaForm.valid),console.log("Archivo seleccionado:",!!this.archivoFile),this.ArchivoEntidadAliadaForm.valid||Object.keys(this.ArchivoEntidadAliadaForm.controls).forEach(e=>{let t=this.ArchivoEntidadAliadaForm.get(e);t?.invalid&&console.log(`Campo ${e} inv\xE1lido:`,t.errors)}),alert("Por favor complete todos los campos requeridos y seleccione un archivo")}static{this.\u0275fac=function(t){return new(t||o)(_(j),_(H),_(Z))}}static{this.\u0275cmp=M({type:o,selectors:[["app-detalle-entidad-aliada"]],viewQuery:function(t,i){if(t&1&&(b(Re,5),b(w,5),b(D,5)),t&2){let l;x(l=C())&&(i.fileInput=l.first),x(l=C())&&(i.paginator=l.first),x(l=C())&&(i.sort=l.first)}},standalone:!0,features:[R],decls:64,vars:10,consts:[["input",""],["fileInput",""],["id","wrapper",1,"d-flex"],["id","content-wrapper",1,"d-flex","flex-column","w-100"],["id","content",1,"d-flex","flex-column","w-100"],[1,"container-fluid"],[1,"d-sm-flex","align-items-center","justify-content-between","mb-4"],[1,"h3","mb-0","text-gray-800"],[1,"row"],[1,"col-lg-9","mb-4","mx-auto"],[1,"card","shadow","mb-4"],[1,"card-header","py-3","bg-primary","text-white"],[1,"m-0","font-weight-bold"],[1,"card-body"],[1,"row","mb-3"],[1,"col-md-6"],["for","fecha",1,"form-label"],["type","date","disabled","","id","fecha","required","",1,"form-control",3,"value"],["for","nombre",1,"form-label"],["type","text","id","nombre","disabled","","placeholder","Ej: Municipalidad de Abancay","required","",1,"form-control",3,"value"],[1,"mb-3"],["for","descripcion",1,"form-label"],["id","descripcion","rows","4","disabled","","placeholder","Escribe una descripci\xF3n de la entidad aliada...","required","",1,"form-control",3,"value"],["class","text-center mb-3",4,"ngIf"],[1,"d-flex","justify-content-end"],[1,"btn","btn-primary",3,"click"],["class","card-body",4,"ngIf"],["appearance","outline",1,"w-100"],["matInput","","placeholder","Buscar por nombre...",3,"keyup"],["matSuffix",""],[1,"mat-elevation-z8"],["mat-table","","matSort","",1,"w-100",3,"dataSource"],["matColumnDef","nombre_archivo"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","fecha_registro"],["matColumnDef","acciones"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["aria-label","Seleccione p\xE1gina de archivos",3,"pageSizeOptions"],[1,"text-center","mb-3"],["alt","Previsualizaci\xF3n",1,"img-fluid","rounded","shadow",2,"max-height","250px",3,"src"],[3,"ngSubmit","formGroup"],[1,"mb-3","row"],[1,"col-md-8"],["for","nombreArchivo",1,"form-label"],["type","text","id","nombreArchivo","formControlName","nombre_archivo",1,"form-control"],["class","text-danger",4,"ngIf"],[1,"col-md-4"],["for","fechaRegistro",1,"form-label"],["type","date","id","fechaRegistro","formControlName","fecha_registro",1,"form-control"],["id","descripcion","formControlName","descripcion","rows","3",1,"form-control"],["for","documentos",1,"form-label"],["type","file","accept",".pdf, .doc, .docx, .xls, .xlsx","id","documentos",1,"form-control",3,"change"],["type","submit",1,"btn","btn-primary"],[1,"text-danger"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","color","primary","matTooltip","Descargar archivo",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar archivo",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell"]],template:function(t,i){if(t&1){let l=A();r(0,"div",2),s(1,"app-sidebar"),r(2,"div",3)(3,"div",4),s(4,"app-topbar"),r(5,"div",5)(6,"div",6)(7,"h1",7),n(8,"Detalles de la entidad aliada"),a()(),r(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"h5",12),n(14,"Detalles Entidad Aliada"),a()(),r(15,"div",13)(16,"form")(17,"div",14)(18,"div",15)(19,"label",16),n(20,"Fecha de Registro"),a(),s(21,"input",17),a(),r(22,"div",15)(23,"label",18),n(24,"Nombre"),a(),s(25,"input",19),a()(),r(26,"div",20)(27,"label",21),n(28,"Descripci\xF3n"),a(),s(29,"textarea",22),a(),p(30,Ne,5,1,"div",23),r(31,"div",24)(32,"button",25),v("click",function(){return h(l),f(i.toggleFormulario())}),n(33,"Agregar documentos"),a()()()()(),r(34,"div",10)(35,"div",11)(36,"h5",12),n(37,"Agregar Documentos"),a()(),p(38,je,26,5,"div",26),r(39,"div",13)(40,"div",20)(41,"mat-form-field",27)(42,"mat-label"),n(43,"Buscar archivo"),a(),r(44,"input",28,0),v("keyup",function(Te){return h(l),f(i.applyFilter(Te))}),a(),r(46,"mat-icon",29),n(47,"search"),a()()(),r(48,"div",30)(49,"table",31),g(50,32),p(51,He,2,0,"th",33)(52,Qe,2,1,"td",34),E(),g(53,35),p(54,Be,2,0,"th",33)(55,$e,3,4,"td",34),E(),g(56,36),p(57,Le,2,0,"th",37)(58,ze,7,0,"td",34),E(),p(59,Ge,1,0,"tr",38)(60,We,1,0,"tr",39)(61,Pe,3,1,"tr",40),a(),s(62,"mat-paginator",41),a()()()()()()(),s(63,"app-footer"),a()()}t&2&&(d(21),c("value",i.entidad_aliada.fecha_registro),d(4),c("value",i.entidad_aliada.nombre),d(4),c("value",i.entidad_aliada.descripcion),d(),c("ngIf",i.imagenURL),d(8),c("ngIf",i.mostrarFormulario),d(11),c("dataSource",i.dataSource),d(10),c("matHeaderRowDef",i.displayedColumns),d(),c("matRowDefColumns",i.displayedColumns),d(2),c("pageSizeOptions",V(9,Ve)))},dependencies:[De,Me,ye,ae,ie,ee,te,re,oe,de,se,w,O,U,q,J,G,Q,B,$,z,Ce,pe,he,ge,fe,ue,Ee,ve,_e,Ae,be,xe,le,ne,we,D,Fe,K,W,P,Y,X,ce,me]})}}return o})();export{wt as DetalleEntidadAliadaComponent};
